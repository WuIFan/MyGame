<!doctype html>	
<html>
	<head>
		<meta charset="utf-8">
		<title>敲好玩</title>
		<style type="text/css">
			#MyCanvas{
				border: 1px solid black;
				position: absolute;
				left: 300px;
				top: 150px;											
			}
		</style>
	</head>
	<body>
		<div>score:<span id="score">0</span>,<span id="test">0</span></div>
		<div>Health:<span id="health">0</span></div>
		<div>EnemyHealth:<span id="enemyhealth">0</span></div>
		<canvas id="MyCanvas" width="800" height="500"></canvas>
		<script>
			var c=document.getElementById("MyCanvas");
			var ctx=c.getContext("2d"); //2D繪圖

			//設定外牆
			var wallX=2.5;
			var wallY=2.5;
			var wallBorder=5;
			var wallColor="#3A006F";

			var wallWidth=c.width-wallBorder;						
			var wallHeight=c.height-wallBorder;

			//畫出外牆
			function drawWall(){
				ctx.strokeStyle=wallColor;
				ctx.lineWidth=wallBorder;
				//ctx.strokeRect(wallX,wallY,wallWidth,wallHeight);
			}

			//邊界
			var topBound = wallBorder+wallY;						//7.5
     		var bottomBound = wallHeight - wallBorder-35-87;		//495
      		var leftBound = wallX+wallBorder/2; 					//5
      		var rightBound = wallX + wallWidth - wallBorder/2;		//2.5+800-5-2.5=795

      		var background=new Image()
      		background.src="bg.png";
      		background.onload=function(){
      			ctx.drawImage(background,0,0);
      			ctx.drawImage(enemy1,enemy1StartX,enemy1StartY);
      			ctx.drawImage(player,PlayerStartX,PlayerStartY);
      		}

      		var unit=10 //移動的單位

			 
     		var player=new Image();//    63*97
     		var player2=new Image();//
			var playerwidth=63+14;
			var playerbound=63;
     		var playerheight=97;
     		var PlayerStartX=50;
     		var PlayerStartY=500-35-playerheight;					//465-87=379
     		var PlayerLeftBound=leftBound;							//5
     		var PlayerRightBound=rightBound-playerwidth;			//
     		var PlayerStartXOld=50;                              	//50,92
     		var PlayerStartYOld=500-35-playerheight;
     		
     		var direction=0;
     		player.src="player.png";
     		player2.src="player2.png";
     		var health=100;
     		document.getElementById("health").innerHTML=health;

     		var enemy1=new Image();//63*58
			var enemy1width=63;
     		var enemy1height=58;
     		var enemy1StartX=700;
     		var enemy1StartY=500-35-enemy1height;
     		
     		enemy1.src="enemy1.png";
     		enemy1.onload=function(){
     			ctx.drawImage(enemy1,enemy1StartX,enemy1StartY);
     		}

     		var enemy1attack=new Image();//20*18
     		var enemy1attackwidth=20;
     		var enemy1attackheight=18;

     		var playerattackboundX1=playerbound+enemy1attackwidth;	 //被攻擊範圍
     		var playerattackboundY1=playerheight+enemy1attackheight;


     		var enemy1attackStartX=enemy1StartX-enemy1attackwidth;
     		var enemy1attackStartY=enemy1StartY; 
     		var enemy1attackStartXold=enemy1attackStartX;
     		var enemy1attackStartYold=enemy1attackStartY;

     		var enemy1StartX1=700;
        	var enemy1StartY1=500-35-enemy1height;
        	var enemy1attackStartX1=enemy1StartX1-enemy1attackwidth;
        	var enemy1attackStartY1=enemy1StartY1; 
        	var enemy1attackStartX1old=enemy1attackStartX1;
        	var enemy1attackStartY1old=enemy1attackStartY1;

     		enemy1attack.src="enemy1attack.png";
     		
     		var enemyalive=10;
     		var enemyhealth1=10;     		
     		document.getElementById("enemyhealth").innerHTML=enemyalive;

     		function round1(enemyalive){
	     		window.setTimeout(function(){
	     			enemyalive=enemyhealth1;
	     			//alert(enemyalive+"asd"+enemyhealth1);
					
	     			if(enemyalive>0){
						enemy1attackStartX=enemy1StartX-enemy1attackwidth;
	     				enemy1attackStartY=enemy1StartY;
	     				enemy1attackStartX1=enemy1StartX1-enemy1attackwidth;
             			enemy1attackStartY1=enemy1StartY1; 
	     				enemy1fight();
	     				enemy1fight2();     			
	     				round1(enemyalive);
	     			}
	     			else{

	     			}

	     		},5000);	     		
	     	}


     		function enemy1fight(){
     			window.setTimeout(function(){
     			enemy1attackStartXold=enemy1attackStartX;
     			enemy1attackStartYold=enemy1attackStartY;
     			enemy1attackStartX=enemy1attackStartX-1;

     			var PlayerStartattackX=PlayerStartX-enemy1attackwidth;
     			var PlayerStartattackY=PlayerStartY+enemy1attackheight;
     			
     			if(enemy1attackStartX<=leftBound){
     				ctx.drawImage(background,enemy1attackStartXold,enemy1attackStartYold,enemy1attackwidth,enemy1attackheight,enemy1attackStartXold,enemy1attackStartYold,enemy1attackwidth,enemy1attackheight);     				
     			}

     			else if(enemy1attackStartX<PlayerStartattackX||enemy1attackStartX>PlayerStartattackX+playerattackboundX1||enemy1attackStartY<PlayerStartattackY||enemy1attackStartY>PlayerStartattackY+playerattackboundY1){
				ctx.drawImage(background,enemy1attackStartXold,enemy1attackStartYold,enemy1attackwidth,enemy1attackheight,enemy1attackStartXold,enemy1attackStartYold,enemy1attackwidth,enemy1attackheight);//用背景蓋住 
				ctx.drawImage(enemy1attack,enemy1attackStartX,enemy1attackStartY);					
					enemy1fight();
				}				
				else{
					ctx.drawImage(background,enemy1attackStartXold,enemy1attackStartYold,enemy1attackwidth,enemy1attackheight,enemy1attackStartXold,enemy1attackStartYold,enemy1attackwidth,enemy1attackheight);
					health=health-1;					
					document.getElementById("health").innerHTML=health;					
				}


     			},3);    			
     			
     		}
     		function enemy1fight2(){
		        window.setTimeout(function(){
		        enemy1attackStartX1old=enemy1attackStartX1;
		        enemy1attackStartY1old=enemy1attackStartY1;
		        enemy1attackStartX1=enemy1attackStartX1-1;
		        enemy1attackStartY1=enemy1attackStartY1-1;
		        var PlayerStartattackX=PlayerStartX-enemy1attackwidth;
		        var PlayerStartattackY=PlayerStartY+enemy1attackheight;
		        
		        if(enemy1attackStartY1<=topBound){
		          ctx.drawImage(background,enemy1attackStartX1old,enemy1attackStartY1old,enemy1attackwidth,enemy1attackheight,enemy1attackStartX1old,enemy1attackStartY1old,enemy1attackwidth,enemy1attackheight);		          
		        }

		        else if(enemy1attackStartX1<PlayerStartattackX||enemy1attackStartX1>PlayerStartattackX+playerattackboundX1||enemy1attackStartY1<PlayerStartattackY||enemy1attackStartY1>PlayerStartattackY+playerattackboundY1){
		        ctx.drawImage(background,enemy1attackStartX1old,enemy1attackStartY1old,enemy1attackwidth,enemy1attackheight,enemy1attackStartX1old,enemy1attackStartY1old,enemy1attackwidth,enemy1attackheight);//用背景蓋住 
		        ctx.drawImage(enemy1attack,enemy1attackStartX1,enemy1attackStartY1);          
		          enemy1fight2();
		        }       
		        else{
		          ctx.drawImage(background,enemy1attackStartX1old,enemy1attackStartY1old,enemy1attackwidth,enemy1attackheight,enemy1attackStartX1old,enemy1attackStartY1old,enemy1attackwidth,enemy1attackheight);
		          health=health-1;          
		          document.getElementById("health").innerHTML=health;
		          //break;
		        }


		        },3);         
          
        }






     		player.onload=function(){
     			ctx.drawImage(player,PlayerStartX,PlayerStartY);     			
     		}
     		function drawPlayer(){    				
     				//ctx.drawImage(background,0,0);
     				ctx.drawImage(background,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight);//用背景蓋住 				
     				if(direction<5){     				
     				ctx.drawImage(player,PlayerStartX,PlayerStartY);
     				direction++;   
     				}
     				else if(direction<10){
     					ctx.drawImage(player2,PlayerStartX,PlayerStartY);		//5步換一次腳
     					direction++;
     					if(direction==10){
     						direction=0;
     					} 
     				} 	
     				ctx.drawImage(enemy1,enemy1StartX,enemy1StartY);			
     		}
     		
     		function movePlayer(unit){        		
       			PlayerStartXOld=PlayerStartX;
       			PlayerStartYOld=PlayerStartY;
       			document.getElementById("score").innerHTML=PlayerStartXOld;       			
        		PlayerStartX += unit;
       			if(PlayerStartX < PlayerLeftBound) {
          			PlayerStartX = PlayerLeftBound;          			
       			}
       			else if(PlayerStartX > PlayerRightBound){
         			PlayerStartX = PlayerRightBound;
       			} 
       			else if((PlayerStartX<87+playerwidth/2||PlayerStartX>232-playerwidth/4)&&PlayerStartY==338-playerheight){       				
       				downPlayer(jumpheight);       				
       			}
       			document.getElementById("test").innerHTML=PlayerStartX;       			       			     			
       			drawPlayer();
      		}

      		var delay=30;
      		var jumpdelay=7;
      		var jumpheight=30;

      		function jumpPlayer(i){      			
      			
      				

      				window.setTimeout(function(){  
      				    PlayerStartXOld=PlayerStartX;
      					PlayerStartYOld=PlayerStartY;
      				
      					PlayerStartY=PlayerStartY-5;
      					if(PlayerStartY<=topBound){
      						PlayerStartY=topBound;      						
      						ctx.drawImage(background,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight);//用背景蓋住 			
	      					ctx.drawImage(player,PlayerStartX,PlayerStartY);
      						downPlayer(jumpheight);
      					}
      					else{
	      					ctx.drawImage(background,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight);//用背景蓋住 			
	      					ctx.drawImage(player,PlayerStartX,PlayerStartY);
	      					ctx.drawImage(enemy1,enemy1StartX,enemy1StartY);
	      					if(--i){
	      						jumpPlayer(i);
	      					} 
      					} 

      				},jumpdelay);
      				if(i==1){
      					downPlayer(jumpheight);
      				}      				
      		};

      		function downPlayer(i){
      				
      				window.setTimeout(function(){
      					PlayerStartXOld=PlayerStartX;
      					PlayerStartYOld=PlayerStartY;
      				
      					PlayerStartY=PlayerStartY+5;
      					if(PlayerStartY>bottomBound){
      						PlayerStartY=bottomBound;
      					}
      					else if(PlayerStartX>=87-playerwidth/2&&PlayerStartX<=232-playerwidth/4&&PlayerStartY>=338-playerheight){
      						PlayerStartY=338-playerheight;
      						ctx.drawImage(background,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight);//用背景蓋住 
	      					ctx.drawImage(player,PlayerStartX,PlayerStartY);
      					}
      					else{
	      					ctx.drawImage(background,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight);//用背景蓋住 
	      					ctx.drawImage(player,PlayerStartX,PlayerStartY);
	      					ctx.drawImage(enemy1,enemy1StartX,enemy1StartY);

	      					if(--i){
	      						downPlayer(i);
	      					}
	      					if(i==0){
	      						PlayerStartYOld=PlayerStartY;
	      					}
      					}
      				},jumpdelay);

      		}

      		var PlayerA=new Image();
      		PlayerA.src="playerattack.png";
      		var attackmotion=1;
      		function PlayerAttack(attackmotion){
					PlayerStartXOld=PlayerStartX;
	      			PlayerStartYOld=PlayerStartY;
	      			ctx.drawImage(background,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight);//用背景蓋住 
	      			ctx.drawImage(PlayerA,PlayerStartX,PlayerStartY);//攻擊圖
	      			ctx.drawImage(enemy1,enemy1StartX,enemy1StartY);
	      			attackmotion--;	      			
	      			if(attackmotion==0){
						if(PlayerStartX+playerwidth>enemy1StartX&&PlayerStartX+playerwidth<enemy1StartX+enemy1width&&PlayerStartY<enemy1StartY&&PlayerStartY>enemy1StartY-enemy1height){	//打到怪物
      						enemyhealth1--;
      						
      						document.getElementById("enemyhealth").innerHTML=enemyhealth1;		      						      						
      					}

						window.setTimeout(function(){
							
	      					PlayerAttack();
	      				},1000);
      					
	      			}
	      			else{
	      				ctx.drawImage(background,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight,PlayerStartXOld,PlayerStartYOld,playerwidth,playerheight);//用背景蓋住
	      				
	      				drawPlayer();
	      				ctx.drawImage(enemy1,enemy1StartX,enemy1StartY);
	      				attackmotion=1;
	      			}
      			}

      		// 偵測鍵盤事件
			window.onkeydown = function(event){
        		switch(event.keyCode){
          			case 37:  // 向左
            			movePlayer(-unit);
           				break;
          			case 39:  // 向右
            			movePlayer(unit);            			
            			break;
            		case 38:  //跳
            			jumpPlayer(jumpheight);            			
            			break;
            		case 65:
            			PlayerAttack(attackmotion);
            			break;
        		}
        		// if(event.keyCode==37){
        		// 	movePlayer(-unit);
        		// 	jumpPlayer(jumpheight);
        		// }
        		// else if(event.keyCode==39){
        		// 	movePlayer(unit);
        		// }
        		// if(event.keyCode==38){
        		// 	jumpPlayer(jumpheight); 
        		// }
        		// if(event.keyCode==65){
        		// 	PlayerAttack(attackmotion);
        		// }

     		};


			

			drawWall();
			round1(enemyalive);
			
			
		</script>
		<!-- <img src="player.jpg"> -->

		
	</body>
</html>